---
title: 操作系统修炼秘籍（18）：进程间通信(3)：套接字
p: os/IPC_socket.md
date: 2019-11-18 13:20:43
tags: OS
categories: OS
---


-----------

**[点我查看操作系统秘籍连载](https://www.junmajinlong.com/os/index/)**

-----------


# 套接字

套接字（Socket）用于协调不同计算机上的进程间通信，也就是基于网络的通信。当然，也可以在本机上使用套接字进行进程间的通信。

套接字通信的方式非常多，有Unix域套接字、TCP套接字、UDP套接字、链路层套接字等等。但最常用的肯定是TCP套接字。所以，这里介绍下TCP Socket通信方式，稍后再单独介绍Unix域套接字。

TCP Socket用于客户端、服务端的基于TCP协议的通信，所以在客户端和服务端均需要创建一个套接字。创建TCP套接字时会返回这个套接字的文件描述符，可通过这个文件描述符对套接字进行读和写操作。

对比一下，当一个程序需要对一个磁盘文件同时进行读写操作（在命令行下似乎没有找到这种命令，但通过编程方式是很容易实现的）时，由于只通过单个文件描述符同时负责读和写，很可能需要通过不断移动文件指针的方式来改变读写的位置，否则数据很容易错乱。

而TCP套接字也是通过单个文件描述符进行读写套接字的，为了保证读和写的位置不错乱，操作系统在内核空间为每个TCP套接字维护了两个buffer空间，一个buffer用于写、一个buffer用于读。提供读的buffer空间称为**recv buffer**，提供写的buffer空间称为**send buffer**，它们统称为**socket buffer**。

所以，服务端和客户端通过两个套接字通信就简单了，一端向send buffer写数据，该buffer的数据会通过已经建立好的TCP连接发送到另一端的recv buffer，于是另一端只需从recv buffer中读数据即可实现不同计算机上的进程间通信。过程如图。

![](/img/os/733013-20191118131539499-1868276051.jpg)


# Unix域套接字

Unix域套接字是套接字的一种，用于本机进程间通信，一般用来实现双向通信的管道。Unix域套接字是比网络套接字轻量级且高效的多，因为它不涉及网络通信，不需要监听连接，不需要绑定地址，不需要关心协议类型，等等。

创建Unix域套接字后返回两个文件描述符，这两个文件描述符均对套接字可读、可写，从而实现全双工的双向通信。

同样的，为了避免使用单个文件描述符同时读、写造成的数据错乱，Unix域套接字也有两个buffer空间。

![](/img/os/733013-20191118131553241-145792831.jpg)
