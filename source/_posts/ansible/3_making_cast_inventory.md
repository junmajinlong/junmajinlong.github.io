---
title: 3.åˆ¶å®šæ¼”å‘˜è¡¨ï¼šinventory
p: ansible/3_making_cast_inventory.md
date: 2021-07-11 10:37:31
tags: Ansible
categories: Ansible
---

--------

**å›åˆ°ï¼š[Ansibleç³»åˆ—æ–‡ç« ](/ansible/index)**  

--------

> å„ä½è¯»è€…ï¼Œè¯·æ‚¨ï¼šç”±äºAnsibleä½¿ç”¨Jinja2æ¨¡æ¿ï¼Œå®ƒçš„æ¨¡æ¿è¯­æ³•{% raw %} {{}} {% endraw %}å’Œ{% raw %} {%%} {% endraw %}å’Œæˆ‘åšå®¢ç³»ç»Ÿhexoçš„æ¨¡æ¿ä½¿ç”¨çš„ç¬¦å·ä¸€æ ·ï¼Œåœ¨æ¸²æŸ“æ—¶ä¼šäº§ç”Ÿå†²çªï¼Œå°½ç®¡æˆ‘å°½æˆ‘åŠªåŠ›åœ°èŠ±äº†å¤§é‡æ—¶é—´åšäº†è°ƒæ•´ï¼Œä½†æ— æ³•ä¿è¯å·²ç»å…¨éƒ¨éƒ½è°ƒæ•´ã€‚å› æ­¤ï¼Œå¦‚æœå„ä½é˜…è¯»æ—¶å‘ç°ä¸€äº›æ˜æ˜¾çš„è¯¡å¼‚çš„é”™è¯¯(æ¯”å¦‚åƒè¿™æ ·çš„ç©ºçš„` `è¡Œå†…ä»£ç )ï¼Œè¯·ä¸€å®šè¦å›å¤æˆ‘ä¿®æ­£è¿™äº›æ¸²æŸ“é”™è¯¯ã€‚


# 3.åˆ¶å®šæ¼”å‘˜è¡¨ï¼šinventory

åœ¨æ²¡æœ‰å¯¹Ansibleåšä»»ä½•é…ç½®çš„æ—¶å€™ï¼ŒAnsibleåªèƒ½é€šè¿‡localhostæ¥æ§åˆ¶æœ¬æœºï¼Œæ‰€ä»¥åœ¨ä¹‹å‰çš„åˆä½“éªŒä¸­ï¼Œéƒ½æ˜¯è®©AnsibleæŒ‡æŒ¥æœ¬æœºå»æ‰§è¡Œä»»åŠ¡ï¼Œè¿™ç¦»æ‰¹é‡æ§åˆ¶è¿œç¨‹ä¸»æœºçš„ç›®æ ‡è¿˜æœ‰ç‚¹è¿œã€‚Ansibleè‚¯å®šæ˜¯æ”¯æŒæŒ‡æŒ¥è¿œç¨‹ä¸»æœºæ‰§è¡Œä»»åŠ¡çš„ï¼Œå¦‚ä½•æŒ‡å®šå“ªäº›è¿œç¨‹ä¸»æœºæ‰§è¡Œä»»åŠ¡å‘¢ï¼Ÿ

è®©Ansibleå‘æŒ¥å¼ºå¤§ä½œç”¨çš„ç¬¬ä¸€æ­¥æ˜¯é…ç½®inventoryã€‚inventoryè¡¨ç¤ºæ¸…å•çš„æ„æ€ï¼Œåœ¨è®¡ç®—æœºé¢†åŸŸé‡Œå¾€å¾€è¡¨ç¤ºçš„èµ„æºæ¸…å•ï¼Œåœ¨Ansibleä¸­å®ƒè¡¨ç¤ºä¸»æœºèŠ‚ç‚¹æ¸…å•ï¼Œä¹Ÿæ˜¯èµ„æºçš„ä¸€ç§ã€‚é€šè¿‡é…ç½®inventoryï¼Œå°±å¯ä»¥å®šä¹‰å“ªäº›ç›®æ ‡ä¸»æœºæ˜¯å¯ä»¥è¢«æ§åˆ¶çš„ã€‚

è¿™æœ‰ç‚¹åƒæ˜¯æ‹ç”µå½±å‰å…ˆç¡®å®šå¥½æ¼”å‘˜è¡¨ä¸€æ ·ï¼Œæ¼”å‘˜è¡¨å°±æ˜¯inventoryï¼Œå®šå¥½äº†æ¼”å‘˜ï¼Œç”µå½±å°±å¯ä»¥æ­£å¼å¼€æ‹ï¼Œæ¼”å‘˜åˆ™å„è‡ªå°±ä½å»å®Œæˆå‰§æœ¬åˆ†æ´¾ç»™ä»–ä»¬çš„ä»»åŠ¡(ä¹‹åè¿˜ä¼šå‘ç°ï¼Œä½¿ç”¨Ansibleè·Ÿæ‹ç”µå½±åœ¨å¾ˆå¤šæ–¹é¢æ˜¯ç›¸ä¼¼çš„)ã€‚

## 3.1 inventoryæ–‡ä»¶è·¯å¾„

é»˜è®¤çš„inventoryæ–‡ä»¶æ˜¯/etc/ansible/hostsï¼Œå¯ä»¥é€šè¿‡Ansibleé…ç½®æ–‡ä»¶çš„`inventory`é…ç½®æŒ‡ä»¤å»ä¿®æ”¹è·¯å¾„ã€‚
```shell
$ grep '/etc/ansible/hosts' /etc/ansible/ansible.cfg 
#inventory      = /etc/ansible/hosts
```

ä½†é€šå¸¸ä¸ä¼šå»ä¿®æ”¹è¿™ä¸ªé…ç½®é¡¹ï¼Œå¦‚æœåœ¨å…¶å®ƒåœ°æ–¹å®šä¹‰äº†inventoryæ–‡ä»¶ï¼Œå¯ä»¥ç›´æ¥åœ¨ansibleçš„å‘½ä»¤è¡Œä¸­ä½¿ç”¨`-i`é€‰é¡¹å»æŒ‡å®šè‡ªå®šä¹‰çš„inventoryæ–‡ä»¶ã€‚
```shell
$ ansible -i /tmp/myinv.ini ...
$ ansible-playbook -i /tmp/myinv.ini ...
```

## 3.2 é…ç½®inventory

Ansible inventoryæ–‡ä»¶çš„ä¹¦å†™æ ¼å¼éµå¾ªinié…ç½®æ ¼å¼ã€‚ä»Ansible 2.4å¼€å§‹æ”¯æŒå…¶å®ƒæ ¼å¼ï¼Œæ¯”å¦‚yamlæ ¼å¼çš„inventoryã€‚æ­¤å¤„ä»¥iniæ ¼å¼ä¸ºä¾‹ï¼Œå¾ªåºæ¸è¿›åœ°ä»‹ç»inventoryçš„è§„åˆ™ã€‚å‡è®¾æ‰€æœ‰çš„è§„åˆ™éƒ½å®šä¹‰åœ¨/etc/ansible/hostsæ–‡ä»¶ä¸­ã€‚

### 3.2.1 ä¸€è¡Œä¸€ä¸»æœºçš„å®šä¹‰æ–¹å¼

Ansibleé»˜è®¤æ˜¯åŸºäºsshè¿æ¥çš„ï¼Œæ‰€ä»¥ä¸€èˆ¬æƒ…å†µä¸‹inventoryä¸­çš„æ¯ä¸ªç›®æ ‡èŠ‚ç‚¹éƒ½é…ç½®ä¸»æœºåæˆ–IPåœ°å€ã€sshdç›‘å¬çš„ç«¯å£å·ã€è¿æ¥çš„ç”¨æˆ·åå’Œå¯†ç ã€sshè¿æ¥æ—¶çš„å‚æ•°ç­‰ç­‰ã€‚å½“ç„¶ï¼Œå¾ˆå¤šå‚æ•°æœ‰é»˜è®¤å€¼ï¼Œæ‰€ä»¥æœ€ç®€å•çš„æ˜¯ç›´æ¥æŒ‡å®šä¸»æœºåæˆ–IPåœ°å€å³å¯ã€‚

ä¾‹å¦‚ï¼Œåœ¨é»˜è®¤çš„inventoryæ–‡ä»¶/etc/ansible/hostsæ·»åŠ å‡ ä¸ªç›®æ ‡ä¸»æœºï¼š
```ini
node1
node2 ansible_host=192.168.200.28
192.168.200.31
192.168.200.32:22
192.168.200.3[2:3] ansible_port=22
```

è¿™æ ·å®šä¹‰ä¹‹åï¼ŒAnsibleå°±å¯ä»¥æ§åˆ¶ä»»ä½•ä¸€ä¸ªç›®æ ‡ä¸»æœºäº†ï¼š
```shell
$ ansible node1 -m copy -a 'src=/etc/passwd dest=/tmp'
$ ansible 192.168.200.31 -m copy -a 'src=/etc/passwd dest=/tmp'
```

ä¸Šé¢çš„inventoryé…ç½®ä¸­ï¼š  

![](/img/ansible/1625968723591.png)

èŒƒå›´å±•å¼€çš„æ–¹å¼è¿˜æ”¯æŒå­—æ¯èŒƒå›´ã€‚ä¸‹é¢éƒ½æ˜¯æœ‰æ•ˆçš„ï¼š
```
èŒƒå›´è¡¨ç¤º      å±•å¼€ç»“æœ
--------------------
a[1:3]  -->  a1,a2,a3
[08:12] -->  08,09,10,11,12
a[a:c]  -->  aa,ab,ac
```

ä¸Šé¢ç¤ºä¾‹ä¸­ä½¿ç”¨äº†ä¸¤ä¸ªä¸»æœºå˜é‡`ansible_port`å’Œ`ansible_host`ï¼Œå®ƒä»¬ç›´æ¥å®šä¹‰åœ¨ä¸»æœºçš„åé¢ï¼Œè¿™äº›å˜é‡éƒ½æ˜¯è¿æ¥ç›®æ ‡ä¸»æœºæ—¶çš„è¡Œä¸ºæ§åˆ¶å˜é‡ï¼Œé€šå¸¸å®ƒä»¬éƒ½èƒ½è§åçŸ¥æ„ã€‚Ansibleæ”¯æŒå¾ˆå¤šä¸ªè¿æ¥æ—¶çš„è¡Œä¸ºæ§åˆ¶å˜é‡ï¼Œè€Œä¸”ä¸åŒç‰ˆæœ¬çš„Ansibleçš„è¡Œä¸ºæ§åˆ¶å˜é‡åç§°å¯èƒ½è¿˜ä¸åŒï¼Œæ¯”å¦‚åœ¨ä»¥å‰ç‰ˆæœ¬ä¸­æŒ‡å®šç«¯å£å·çš„è¡Œä¸ºå˜é‡æ˜¯`ansible_ssh_port`ã€‚

å®Œæ•´çš„è¿æ¥è¡Œä¸ºæ§åˆ¶å˜é‡å‚è§å®˜æ–¹æ‰‹å†Œï¼š[Connecting to hosts: behavioral inventory parameters](https://docs.ansible.com/ansible/latest/user_guide/intro_inventory.html#connecting-to-hosts-behavioral-inventory-parameters)ã€‚ä¸‹é¢è§£é‡Šå‡ ä¸ªå¸¸è§çš„è¡Œä¸ºå˜é‡ã€‚

| Inventoryå˜é‡å                  | å«ä¹‰                                                         |
| :------------------------------- | :----------------------------------------------------------- |
| **ansible_host**                 | ansibleè¿æ¥èŠ‚ç‚¹æ—¶çš„IPåœ°å€                                    |
| **ansible_port**                 | è¿æ¥å¯¹æ–¹çš„ç«¯å£å·ï¼Œsshè¿æ¥æ—¶é»˜è®¤ä¸º22                          |
| **ansible_user**                 | è¿æ¥å¯¹æ–¹ä¸»æœºæ—¶ä½¿ç”¨çš„ä¸»æœºåã€‚ä¸æŒ‡å®šæ—¶ï¼Œå°†ä½¿ç”¨æ‰§è¡Œansibleæˆ–ansible-playbookå‘½ä»¤çš„ç”¨æˆ· |
| **ansible_password**             | è¿æ¥æ—¶çš„ç”¨æˆ·å¯†ç                                              |
| **ansible_connection**           | è¿æ¥ç±»å‹ï¼Œæœ‰æ•ˆå€¼åŒ…æ‹¬smartã€sshã€paramikoã€localã€dockerã€winrmï¼Œé»˜è®¤ä¸ºsmartã€‚smartè¡¨ç¤ºæ™ºèƒ½é€‰æ‹©sshå’Œparamikoï¼Œå½“SSHæ”¯æŒControlPersist(å³æŒä¹…è¿æ¥)æ—¶ä½¿ç”¨sshï¼Œå¦åˆ™ä½¿ç”¨paramikoã€‚localå’Œdockeræ˜¯éåŸºäºsshè¿æ¥çš„æ–¹å¼ï¼Œwinrmæ˜¯è¿æ¥windowsçš„æ’ä»¶ |
| **ansible_ssh_private_key_file** | æŒ‡å®šå¯†é’¥è®¤è¯sshè¿æ¥æ—¶çš„ç§é’¥æ–‡ä»¶                              |
| **ansible_ssh_common_args**      | æä¾›ç»™sshã€sftpã€scpå‘½ä»¤çš„é¢å¤–å‚æ•°                           |
| **ansible_become**               | å…è®¸è¿›è¡Œæƒé™æå‡                                             |
| **ansible_become_method**        | æŒ‡å®šæå‡æƒé™çš„æ–¹å¼ï¼Œä¾‹å¦‚å¯ä½¿ç”¨sudo/su/runasç­‰æ–¹å¼            |
| **ansible_become_user**          | æå‡ä¸ºå“ªä¸ªç”¨æˆ·çš„æƒé™ï¼Œé»˜è®¤æå‡ä¸ºroot                         |
| **ansible_become_password**      | æå‡ä¸ºæŒ‡å®šç”¨æˆ·æƒé™æ—¶çš„å¯†ç                                    |


### 3.2.2 inventoryä¸­çš„æ™®é€šå˜é‡

åœ¨å®šä¹‰inventoryæ—¶ï¼Œé™¤äº†å¯ä»¥æŒ‡å®šè¿æ¥çš„è¡Œä¸ºæ§åˆ¶å˜é‡ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šAnsibleçš„æ™®é€šå˜é‡ï¼Œä»¥ä¾¿åœ¨ansibleæ‰§è¡Œä»»åŠ¡æ—¶ä½¿ç”¨ã€‚

ä¾‹å¦‚ï¼š
```ini
node1 node1_var="hello world"
node2 ansible_host=192.168.200.28
```

åœ¨ansibleæ‰§è¡Œä»»åŠ¡æ—¶å¯ä»¥å¼•ç”¨æ™®é€šå˜é‡ï¼š
```shell
$ ansible node1 -m debug -a 'var=node1_var'
node1 | SUCCESS => {
    "node1_var": "hello world"
}
```

### 3.2.3 ä¸»æœºåˆ†ç»„

ä¸Šé¢çš„ç¤ºä¾‹ä¸­æ˜¯æ¯è¡Œå•ç‹¬å®šä¹‰ä¸€ä¸ªä¸»æœºï¼Œè¿™æ ·çš„æ–¹å¼è™½ç„¶ç®€å•ï¼Œä½†æ˜¯æå…¶ä¸æ–¹ä¾¿ç®¡ç†å¤šä¸ªèŠ‚ç‚¹ã€‚

ä¸ºæ­¤ï¼ŒInventoryæ”¯æŒå¯¹ä¸»æœºè¿›è¡Œåˆ†ç»„ï¼Œæ¯ä¸ªç»„å†…å¯ä»¥å®šä¹‰å¤šä¸ªä¸»æœºï¼Œæ¯ä¸ªä¸»æœºéƒ½å¯ä»¥å®šä¹‰åœ¨ä»»ä½•ä¸€ä¸ªæˆ–å¤šä¸ªä¸»æœºç»„å†…ã€‚

ä¾‹å¦‚ï¼š

```ini
node1 node1_var="hello world"
node2 ansible_host=192.168.200.28
192.168.200.31
192.168.200.32:22
192.168.200.3[2:3] ansible_port=22

[nginx]
192.168.200.27
192.168.200.28 ansible_password='123456'
192.168.200.29

[apache]
192.168.200.3[0:3]

[mysql]
192.168.200.27
192.168.200.29
```

è¿™é‡Œå®šä¹‰äº†3ä¸ªä¸»æœºç»„ï¼šnginxä¸»æœºç»„ã€apacheä¸»æœºç»„å’Œmysqlä¸»æœºç»„ã€‚nginxç»„åŒ…å«3ä¸ªèŠ‚ç‚¹ï¼Œapacheä¸»æœºç»„åŒ…å«4ä¸ªèŠ‚ç‚¹ï¼Œmysqlä¸»æœºç»„åŒ…å«2ä¸ªèŠ‚ç‚¹ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œmysqlç»„ä¸­çš„èŠ‚ç‚¹ä¹ŸåŒæ—¶å­˜åœ¨äºnginxç»„å†…ï¼Œä¸€ä¸ªä¸»æœºåŒæ—¶å­˜åœ¨äºå¤šä¸ªç»„å†…æ˜¯å…è®¸ä¹Ÿæ˜¯å¿…è¦çš„åŠŸèƒ½ï¼Œåªæœ‰è¿™æ ·æ‰èƒ½æ›´ä¸ºçµæ´»çš„å¯¹å„ä¸ªèŠ‚ç‚¹è¿›è¡Œåˆ†ç±»ç®¡ç†ã€‚

æœ‰äº†ä¸»æœºç»„ï¼Œå°±å¯ä»¥è®©ansibleæ§åˆ¶ä¸€ä¸ªç»„ï¼Œä»è€Œè®©è¯¥ç»„å†…æ‰€æœ‰ä¸»æœºæ‰§è¡Œä»»åŠ¡ï¼š

```shell
$ ansible apache -m copy -a 'src=/etc/passwd dest=/tmp'
```

Ansibleé»˜è®¤é¢„å®šä¹‰äº†ä¸¤ä¸ªä¸»æœºç»„ï¼š`all`åˆ†ç»„å’Œ`ungrouped`åˆ†ç»„ã€‚
- `all`åˆ†ç»„ä¸­åŒ…å«æ‰€æœ‰åˆ†ç»„å†…çš„èŠ‚ç‚¹  
- `ungrouped`åˆ†ç»„åŒ…å«æ‰€æœ‰ä¸åœ¨åˆ†ç»„å†…çš„èŠ‚ç‚¹  
- è¿™ä¸¤ä¸ªåˆ†ç»„éƒ½ä¸åŒ…å«localhostè¿™ä¸ªç‰¹æ®Šçš„èŠ‚ç‚¹  

å®šä¹‰äº†inventoryä¹‹åï¼Œå¯ä»¥ä½¿ç”¨`ansible --list`æˆ–`ansible--playbook --list`å‘½ä»¤æ¥æŸ¥çœ‹ä¸»æœºç»„çš„ä¿¡æ¯ï¼Œè¿˜å¯ä»¥ä½¿ç”¨æ›´ä¸ºä¸“ä¸šçš„`ansible-inventory`å‘½ä»¤æ¥æŸ¥çœ‹ä¸»æœºç»„ä¿¡æ¯ã€‚

```shell
# ä½¿ç”¨ansibleæˆ–ansible-playbookåˆ—å‡ºæ‰€æœ‰ä¸»æœº
$ ansible -i /etc/ansible/hosts nginx --list
  hosts (3):
    192.168.200.27
    192.168.200.28
    192.168.200.29

# ä½¿ç”¨ansible-inventoryåˆ—å‡ºnginxç»„ä¸­çš„ä¸»æœº
$ ansible-inventory -i /etc/ansible/hosts nginx --graph
@nginx:
  |--192.168.200.27
  |--192.168.200.28
  |--192.168.200.29

# ä½¿ç”¨ansible-inventoryåˆ—å‡ºnginxç»„ä¸­çš„ä¸»æœºï¼ŒåŒæ—¶å¸¦ä¸Šå˜é‡
$ ansible-inventory nginx --graph --vars
@nginx:
  |--192.168.200.27
  |  |--{ansible_password = 123456}
  |  |--{ansible_port = 22}
  |--192.168.200.28
  |  |--{ansible_password = 123456}
  |  |--{ansible_port = 22}
  |--192.168.200.29
  |  |--{ansible_password = 123456}
  |  |--{ansible_port = 22}
  |--{ansible_password = 123456}

# ä½¿ç”¨ansible-inventoryåˆ—å‡ºallç»„å†…çš„ä¸»æœº
$ ansible-inventory --graph all
@all:
  |--@apache:
  |  |--192.168.200.30
  |  |--192.168.200.31
  |  |--192.168.200.32
  |  |--192.168.200.33
  |--@mysql:
  |  |--192.168.200.27
  |  |--192.168.200.29
  |--@nginx:
  |  |--192.168.200.27
  |  |--192.168.200.28
  |  |--192.168.200.29
  |--@ungrouped:
  |  |--node1
  |  |--node2

# ä½¿ç”¨ansible-inventoryä»¥jsonæ ¼å¼åˆ—å‡ºæ‰€æœ‰ä¸»æœºçš„ä¿¡æ¯
$ ansible-inventory --list
```

### 3.2.4 ä¸»æœºç»„å˜é‡

æœ‰äº†ä¸»æœºç»„ä¹‹åï¼Œå¯ä»¥ç›´æ¥ä¸ºä¸»æœºç»„å®šä¹‰å˜é‡ï¼Œè¿™æ ·ç»„å†…çš„æ‰€æœ‰ä¸»æœºéƒ½å…·æœ‰è¯¥å˜é‡ã€‚

```ini
[nginx]
192.168.200.27
192.168.200.28 ansible_password=123456
192.168.200.29

[nginx:vars]
ansible_password='123456'

[all:vars]
ansible_port=22

[ungrouped:vars]
ansible_port=22
```

ä¸Šé¢`[nginx:vars]`è¡¨ç¤ºä¸ºnginxç»„å†…æ‰€æœ‰ä¸»æœºå®šä¹‰å˜é‡`ansible_password='123456'`ã€‚è€Œ`[all:vars]`å’Œ`[ungrouped:vars]`åˆ†åˆ«è¡¨ç¤ºä¸ºallå’Œungroupedè¿™ä¸¤ä¸ªç‰¹æ®Šçš„ä¸»æœºç»„å†…çš„æ‰€æœ‰ä¸»æœºå®šä¹‰å˜é‡ã€‚

### 3.2.5 ç»„åµŒå¥—

Inventoryè¿˜æ”¯æŒä¸»æœºç»„çš„åˆ†ç»„åµŒå¥—ï¼Œå¯ä»¥é€šè¿‡`[GROUP:children]`çš„æ–¹å¼å®šä¹‰ä¸€ä¸ªä¸»æœºç»„ï¼Œå¹¶åœ¨å…¶ä¸­åŒ…å«å­ç»„ã€‚

ä¾‹å¦‚ï¼š

```ini
[nginx]
192.168.200.27
192.168.200.28
192.168.200.29

[apache]
192.168.200.3[0:3]

[webservers:children]
nginx
apache
```

å…¶ä¸­webserversä¸»æœºç»„ä¸­åŒ…å«äº†nginxç»„åˆapacheç»„å†…çš„æ‰€æœ‰ä¸»æœºã€‚

ç”šè‡³ï¼Œè¿˜å¯ä»¥é€’å½’åµŒå¥—ã€‚ä¾‹å¦‚ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œcentos7åˆ†ç»„ä¸­çš„webserversä»ç„¶æ˜¯ä¸€ä¸ªåŒ…å«å­ç»„çš„åˆ†ç»„ã€‚

```ini
[nginx]
192.168.200.27
192.168.200.28
192.168.200.29

[apache]
192.168.200.3[0:3]

[mysql]
192.168.200.27
192.168.200.30

[webservers:children]
nginx
apache

[centos7:children]
webservers
mysql
```

### 3.2.6 å¤šä¸ªinventoryæ–‡ä»¶

å½“Ansibleè¦ç®¡ç†çš„èŠ‚ç‚¹éå¸¸å¤šæ—¶ï¼Œä»…é åˆ†ç»„çš„é€»è¾‘å¯èƒ½ä¹Ÿä¸è¶³å¤Ÿæ–¹ä¾¿ç®¡ç†ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥å®šä¹‰å¤šä¸ªinventoryæ–‡ä»¶å¹¶æ”¾åœ¨ä¸€ä¸ªç›®å½•ä¸‹ï¼Œå¹¶æŒ‰ä¸€å®šçš„å‘½åè§„åˆ™ä¸ºæ¯ä¸ªinventoryå‘½åï¼Œä»¥ä¾¿è§åçŸ¥æ„ã€‚

ä¾‹å¦‚ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º/etc/ansible/inventorysçš„ç›®å½•ï¼Œåœ¨å…¶ä¸­å®šä¹‰aå’Œbä¸¤ä¸ªinventoryæ–‡ä»¶ï¼š

```
/etc/ansible/inventorys/
â”œâ”€â”€ a
â””â”€â”€ b
```

å†…å®¹åˆ†åˆ«å¦‚ä¸‹ï¼š

```ini
# /etc/ansible/inventorys/açš„å†…å®¹ï¼š
[nginx]
192.168.200.27
192.168.200.28 ansible_password='123456'
192.168.200.29

[apache]
192.168.200.3[0:3]

# /etc/ansible/inventorys/bçš„å†…å®¹ï¼š
[mysql]
192.168.200.27
192.168.200.29

[web:children]
apache
nginx

[os:children]
web
mysql
```

ç°åœ¨è¦ä½¿ç”¨å¤šä¸ªinventoryçš„åŠŸèƒ½ï¼Œéœ€è¦å°†inventoryæŒ‡å®šä¸ºç›®å½•è·¯å¾„ã€‚

ä¾‹å¦‚ï¼ŒAnsibleé…ç½®æ–‡ä»¶å°†`inventory`æŒ‡ä»¤è®¾ç½®ä¸ºå¯¹åº”çš„ç›®å½•ï¼š

```
inventory      = /etc/ansible/inventorys
```

æˆ–è€…ï¼Œansibleæˆ–ansible-playbookå‘½ä»¤ä½¿ç”¨`-i INVENTORY`é€‰é¡¹æŒ‡å®šçš„è·¯å¾„åº”å½“ä¸ºç›®å½•ã€‚

```shell
$ ansible-inventory -i /etc/ansible/inventorys --graph all
```

æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å°†åˆ—å‡ºæ‰€æœ‰ä¸»æœºï¼š

```shell
$ ansible-inventory -i /etc/ansible/inventorys --graph all
```

inventoryæŒ‡å®šä¸ºç›®å½•æ—¶ï¼Œinventoryæ–‡ä»¶æœ€å¥½ä¸è¦å¸¦æœ‰åç¼€ï¼Œå°±åƒç¤ºä¾‹ä¸­çš„aå’Œbæ–‡ä»¶ã€‚å› ä¸ºAnsibleå½“ä½¿ç”¨ç›®å½•ä½œä¸ºinventoryæ—¶ï¼Œé»˜è®¤å°†å¿½ç•¥ä¸€äº›åç¼€çš„æ–‡ä»¶ä¸å»è§£æã€‚éœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„`inventory_ignore_extensions`é¡¹æ¥ç¦æ­¢å¿½ç•¥æŒ‡å®šåç¼€(å¦‚iniåç¼€)çš„æ–‡ä»¶ã€‚

```
#inventory_ignore_extensions = ~, .orig, .bak, .ini, .cfg, .retry, .pyc, .pyo
inventory_ignore_extensions = ~, .orig, .bak, .cfg, .retry, .pyc, .pyo
```

## 3.3 åŠ¨æ€inventoryå’Œä¸´æ—¶æ·»åŠ ä¸»æœº

åœ¨å‰é¢ä»‹ç»inventoryçš„ä¸€å¤§æ®µå†…å®¹ä¸­ï¼Œæ‰€æœ‰çš„ä¸»æœºè¿æ¥ä¿¡æ¯éƒ½æ˜¯æŒ‰ç…§Ansibleè¦æ±‚çš„æ ¼å¼ç›´æ¥ä¸€æ­¥åˆ°ä½å®šä¹‰åœ¨æ–‡ä»¶ä¸­ï¼Œè¿™ç§å®šä¹‰æ–¹å¼ç§°ä¸º**é™æ€çš„inventory**(static inventory)ã€‚

Ansibleè¿˜æ”¯æŒæ›´ä¸ºçµæ´»çš„ä¸»æœºæ”¶é›†æ–¹å¼ï¼š**åŠ¨æ€inventory**ã€‚å®ƒå¯ä»¥å°†å…¶å®ƒç¨‹åºæˆ–å·²ç»å­˜åœ¨äºä¸€ä¸ªæ–‡ä»¶ä¸­(æ¯”å¦‚ä¸æ˜¯inventoryæ”¯æŒçš„iniæ ¼å¼çš„æ–‡ä»¶)çš„ä¸»æœºä¿¡æ¯åŠ¨æ€æ”¶é›†èµ·æ¥ã€‚

ä¸ä»…å¦‚æ­¤ï¼ŒAnsibleè¿˜å¯ä»¥é€šè¿‡ç‰¹æ®Šçš„æ¨¡å—`add_host`æ¥ä¸´æ—¶æ·»åŠ ä¸»æœº(ä¹Ÿå°±æ˜¯ä¸´æ—¶æ‰¾æ¥çš„æ¼”å‘˜ğŸ˜„)ï¼Œé€šè¿‡`group_by`æ¥ä¸´æ—¶è®¾ç½®ä¸»æœºç»„ã€‚è¿™ç§æ–¹å¼æ·»åŠ çš„ä¸»æœºæˆ–ä¸»æœºç»„éƒ½åªåœ¨å†…å­˜ä¸­ï¼Œåªåœ¨Ansibleè¿è¡Œæ—¶ç”Ÿæ•ˆï¼ŒAnsibleé€€å‡ºä¹‹åå°±æ¶ˆå¤±ã€‚

ä½†æ— è®ºæ˜¯åŠ¨æ€inventoryè¿˜æ˜¯`add_host`æˆ–`group_by`éƒ½ä¸é€‚åˆåœ¨æ­¤å¤„è¿›è¡Œæ¼”ç¤ºï¼Œåœ¨åé¢çš„æ–‡ç« ä¸­æ¶‰åŠåˆ°çš„æ—¶å€™æˆ‘ä¼šä»‹ç»å…¶ç”¨æ³•ã€‚

## 3.4 æœ¬æ–‡ä½¿ç”¨çš„inventoryæ–‡ä»¶

ä¸‹é¢æ˜¯æœ¬æ–‡ä½¿ç”¨çš„inventoryæ–‡ä»¶/etc/ansible/hostsçš„å†…å®¹ï¼Œåœ¨åé¢çš„æ–‡ç« ä¸­å¦‚æœæ²¡æœ‰ç‰¹åˆ«è¯´æ˜ï¼Œä¹Ÿå°†ä½¿ç”¨æ­¤å¤„çš„inventoryé…ç½®ã€‚

```ini
[nginx]
192.168.200.27
192.168.200.28
192.168.200.29

[apache]
192.168.200.3[0:3]

[webservers:children]
nginx
apache

[mysql]
192.168.200.33
```