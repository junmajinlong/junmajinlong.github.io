---
title: VMWare:查看链接克隆依赖关系
p: others/vmware_dependance.md
date: 2019-07-06 18:20:41
tags: Others
categories: Others
---


我们都知道，虚拟机克隆有完全克隆和链接克隆两种克隆方式。当根据模版去链接克隆出很多机器时，时间一长或者把克隆后的机器改名了，我们就忘记了哪台机器是克隆出来的，哪台是直接装的。如果不小心把模版机器给删除了，通过链接克隆出来的克隆机将全部挂掉。

其实我们可以通过每个虚拟系统的. vmsd 文件去查看该系统相关信息，该文件是虚拟机的元数据文件。如果该系统是克隆模版，可以查看当初根据这个模版克隆过那些系统出来；如果是克隆机器，可以查看出是根据哪个系统克隆的。链接克隆实质上是根据快照去克隆的，如果不是根据快照去链接克隆，克隆时会默认创建一个快照。

查看方式很简单，使用记事本打开 vmsd 文件。本文中出现的的克隆都默认是链接克隆，除非特别指明了。

## 1. 查看是否是克隆机器


例如，查看一个 SQL-C.vmsd 文件。文件内容如下图：

![](/img/others/733013-20160322193149979-1852661393.jpg)

如果在 vmsd 文件的前几行就看到 cloneOf 说明这个是克隆机器。图中的 SQL-C 系统是根据 Win 2008 R2 DC.vmx 克隆出来的。如果没有这个 cloneOf 字眼，说明不是链接克隆机器，而是自己装的或者是完全克隆。

**注意：cloneOf 后的机器名称不会随着克隆模版改名而改名，在克隆完成的那一刻，这一行内容将是永恒不变的。**

## 2. 查看是否是克隆模版

如下图，如果在 vmsd 文件的中后方有 snapshotX.clone（X 代表根据哪个快照克隆的）字眼，说明这个系统是模版。

![](/img/others/733013-20160322194003245-954663400.jpg)

图中说明 Win 2008 R2 DC 是模版，根据它的 snapshot1 快照克隆了 4 台机器。

**注意：该文件中克隆机器的名称也不会随着克隆机器的改名而改名，克隆完成后几行内容也是从此不变的。**

最后，如果既没有 cloneOf 字眼，也没有 snapshotX.clone 字眼，说明这是一个独行侠，上无父母下无子女。