---
title: 操作系统修炼秘籍（4）：内核态和用户态
p: os/kernel_user_space.md
date: 2019-10-09 08:20:41
tags: OS
categories: OS
---


-----------

**[点我查看操作系统秘籍连载](https://www.junmajinlong.com/os/index/)**

-----------


# 限制进程：内核态和用户态

进程可分为两种类型。一是操作系统自身运行时的内核类进程，也称为**操作系统进程**。另一种即非内核类进程，不是操作系统自身的进程，而是想要实现某些功能，用户自己去启动的程序产生的进程，也称为**用户类进程或用户进程**。

操作系统自身也是一个程序，它启动之后也有很多内核进程在后台工作，而且这些内核进程都非常重要，是操作系统正常运行并提供服务的必要进程，比如负责调度类的进程、内存管理类进程等。

而操作系统要提供程序的运行平台，还要管理各类软硬件资源（比如进程调度是在管理CPU资源，内存的分配和回收是在管理内存资源，等等），那么操作系统必然要以一种最高权限的方式去运行，其它用户进程都必须不能具备这个最高权限。

此外，操作系统必须要在任何有需要的时候掌握CPU的控制权，因为进程是通过CPU去执行的，操作系统掌握了CPU的控制权，就代表操作系统进程开始执行。例如，在任何需要进行进程调度的时候，必须能够立即回到操作系统，让负责进程调度的进程开始根据调度算法去调度下一个进程。

![](/img/os/733013-20191009091245514-1014094314.jpg)


> 提示
>
> 需注意，内核模式和用户模式这两种进程状态是CPU提供的控制，而不是操作系统提供的。在CPU中一个称为PSW（program status word，程序状态字）的寄存器中保存了和进程有关的一些控制位，例如内核模式和用户模式的进程状态。

这两种模式描述了进程的工作状态，是工作在内核模式下还是工作在用户模式下。在内核模式下，表示具备了最高权限，操作系统自身进程都是工作在内核模式下；在用户模式下，执行的代码将受到一些限制，用户进程都是工作在用户模式下，该模式下的进程不能执行一些关键性的操作，比如用户进程必须不能让它自己也变成内核态进程工作在内核模式下，这样的话，权限的限制就没有意义了。

工作在这两种状态下的进程也称为**内核态进程和用户态进程**。通常，为了在描述问题时区分内核模式和用户模式的进程，也会把这两种模式称为用户空间和内核空间。如图。

![](/img/os/733013-20191009091108321-433228150.jpg)


那么如何保证在需要的时候，能够立即切换回操作系统呢？通过中断，且待后文再述。